{
  "data": {
    "content": "## Create GitOps (ArgoCD) extension with workload identity\n\nAn alternative installation method recommended for production usage is [workload identity](/azure/aks/workload-identity-deploy-cluster). This method allows you to use Microsoft Entra ID identities to authenticate to Azure resources without needing to manage secrets or credentials in your Git repository. This installation utilizes workload identity authentication enabled in the 3.0.0-rc2 or later OSS version of ArgoCD.\n\n> [!IMPORTANT]\n> The HA mode is the default configuration and requires three nodes in the cluster to be able to install. Add `--config deployWithHighAvailability=false` to install the extension on a single node.\n\nTo create the extension with workload identity, first replace the following variables with your own values in this Bicep template:\n\n```bicep\nvar clusterName = '<aks-or-arc-cluster-name>'\n\nvar workloadIdentityClientId = 'replace-me##-##-###-###'\nvar ssoWorkloadIdentityClientId = 'replace-me##-##-###-###'\n\nvar url = 'https://<public-ip-for-argocd-ui>/auth/callback'\nvar oidcConfig = '''\nname: Azure\nissuer: https://login.microsoftonline.com/<your-tenant-id>/v2.0\nclientID: <same-value-as-ssoWorkloadIdentityClientId-above>\nazure:\n  useWorkloadIdentity: true\nrequestedIDTokenClaims:\n  groups:\n    essential: true\nrequestedScopes:\n  - openid\n  - profile\n  - email\n'''\n\nvar defaultPolicy = 'role:readonly'\nvar policy = '''\np, role:org-admin, applications, *, */*, allow\np, role:org-admin, clusters, get, *, allow\np, role:org-admin, repositories, get, *, allow\np, role:org-admin, repositories, create, *, allow\np, role:org-admin, repositories, update, *, allow\np, role:org-admin, repositories, delete, *, allow\ng, replace-me##-argocd-ui-Microsoft Entra-group-admin-id, role:org-admin\n'''\n\nresource cluster 'Microsoft.ContainerService/managedClusters@2024-10-01' existing = {\n  name: clusterName\n}\n\nresource extension 'Microsoft.KubernetesConfiguration/extensions@2023-05-01' = {\n  name: 'argocd'\n  scope: cluster\n  properties: {\n    extensionType: 'Microsoft.ArgoCD'\n    autoUpgradeMinorVersion: false\n    releaseTrain: 'preview'\n    version: '0.0.7-preview'\n    configurationSettings: {\n      'workloadIdentity.enable': 'true'\n      'workloadIdentity.clientId': workloadIdentityClientId\n      'workloadIdentity.entraSSOClientId': ssoWorkloadIdentityClientId\n      'config-maps.argocd-cm.data.oidc\\\\.config': oidcConfig\n      'config-maps.argocd-cm.data.url': url\n      'config-maps.argocd-rbac-cm.data.policy\\\\.default': defaultPolicy\n      'config-maps.argocd-rbac-cm.data.policy\\\\.csv': policy\n      'config-maps.argocd-cmd-params-cm.data.application\\\\.namespaces': 'default, argocd'\n    }\n  }\n}\n```\n\nThe Bicep template can be created using this command:\n\n`az deployment group create --resource-group <resource-group> --template-file <bicep-file>`",
    "file_path": "/Users/cloudchase/Desktop/Vibe_Coding/Cursor/ai-content-developer/work/tmp/azure-management-docs/articles/azure-arc/kubernetes/tutorial-use-gitops-argocd.md",
    "heading_path": [
      "Tutorial: Deploy applications using GitOps with ArgoCD",
      "Create GitOps (ArgoCD) extension with workload identity"
    ],
    "section_level": 2,
    "chunk_index": 9,
    "frontmatter": {
      "title": "Tutorial: Deploy applications using GitOps",
      "description": "This tutorial shows how to use GitOps with ArgoCD in Azure Arc and AKS clusters.",
      "ms.date": "04/06/2025",
      "ms.topic": "tutorial",
      "ms.custom": "template-tutorial, devx-track-azurecli, references_regions"
    },
    "embedding_content": "Document: Tutorial: Deploy applications using GitOps | Topic: tutorial | Description: This tutorial shows how to use GitOps with ArgoCD in Azure Arc and AKS clusters. | Section: Tutorial: Deploy applications using GitOps with ArgoCD > Create GitOps (ArgoCD) extension with workload identity | ## Create GitOps (ArgoCD) extension with workload identity\n\nAn alternative installation method recommended for production usage is [workload identity](/azure/aks/workload-identity-deploy-cluster). This method allows you to use Microsoft Entra ID identities to authenticate to Azure resources without needing to manage secrets or credentials in your Git repository. This installation utilizes workload identity authentication enabled in the 3.0.0-rc2 or later OSS version of ArgoCD.\n\n> [!IMPORTANT]\n> The HA mode is the default configuration and requires three nodes in the cluster to be able to install. Add `--config deployWithHighAvailability=false` to install the extension on a single node.\n\nTo create the extension with workload identity, first replace the following variables with your own values in this Bicep template:\n\n```bicep\nvar clusterName = '<aks-or-arc-cluster-name>'\n\nvar workloadIdentityClientId = 'replace-me##-##-###-###'\nvar ssoWorkloadIdentityClientId = 'replace-me##-##-###-###'\n\nvar url = 'https://<public-ip-for-argocd-ui>/auth/callback'\nvar oidcConfig = '''\nname: Azure\nissuer: https://login.microsoftonline.com/<your-tenant-id>/v2.0\nclientID: <same-value-as-ssoWorkloadIdentityClientId-above>\nazure:\n  useWorkloadIdentity: true\nrequestedIDTokenClaims:\n  groups:\n    essential: true\nrequestedScopes:\n  - openid\n  - profile\n  - email\n'''\n\nvar defaultPolicy = 'role:readonly'\nvar policy = '''\np, role:org-admin, applications, *, */*, allow\np, role:org-admin, clusters, get, *, allow\np, role:org-admin, repositories, get, *, allow\np, role:org-admin, repositories, create, *, allow\np, role:org-admin, repositories, update, *, allow\np, role:org-admin, repositories, delete, *, allow\ng, replace-me##-argocd-ui-Microsoft Entra-group-admin-id, role:org-admin\n'''\n\nresource cluster 'Microsoft.ContainerService/managedClusters@2024-10-01' existing = {\n  name: clusterName\n}\n\nresource extension 'Microsoft.KubernetesConfiguration/extensions@2023-05-01' = {\n  name: 'argocd'\n  scope: cluster\n  properties: {\n    extensionType: 'Microsoft.ArgoCD'\n    autoUpgradeMinorVersion: false\n    releaseTrain: 'preview'\n    version: '0.0.7-preview'\n    configurationSettings: {\n      'workloadIdentity.enable': 'true'\n      'workloadIdentity.clientId': workloadIdentityClientId\n      'workloadIdentity.entraSSOClientId': ssoWorkloadIdentityClientId\n      'config-maps.argocd-cm.data.oidc\\\\.config': oidcConfig\n      'config-maps.argocd-cm.data.url': url\n      'config-maps.argocd-rbac-cm.data.policy\\\\.default': defaultPolicy\n      'config-maps.argocd-rbac-cm.data.policy\\\\.csv': policy\n      'config-maps.argocd-cmd-params-cm.data.application\\\\.namespaces': 'default, argocd'\n    }\n  }\n}\n```\n\nThe Bicep template can be created using this command:\n\n`az deployment group create --resource-group <resource-group> --template-file <bicep-file>`",
    "embedding": null,
    "embedding_model": null,
    "embedding_generated_at": null,
    "content_hash": "e9053d64c65f61a1bad26777be98b59b86ca83d0c737d6c2db4af1d49304df65",
    "file_id": "40afb2683704ffdcb5f7624f02b0a312ff2bac5d8767707e99ce1c3873aa09da",
    "chunk_id": "7dc2ce0721442c0ebddb94ae76d9062c97bb9116e2d6ae039a661fa8d52fb316",
    "prev_chunk_id": "c6e338451fd96b81544fd989cad1f11c1cc83d847b2b74a724c68fbfe29384f4",
    "next_chunk_id": "0f134119eb4b7d27e746e3ddbbc8cb48028c4154c8c03e06d0eb4a22565706ae",
    "parent_heading_chunk_id": "63a03cfcfa8a9a5165527910acafe1cf7cfb514f79c7761e4f423adf5fd6af24",
    "total_chunks_in_file": 18
  },
  "meta": {
    "type": "chunk",
    "file": "/Users/cloudchase/Desktop/Vibe_Coding/Cursor/ai-content-developer/work/tmp/azure-management-docs/articles/azure-arc/kubernetes/tutorial-use-gitops-argocd.md",
    "section": [
      "Tutorial: Deploy applications using GitOps with ArgoCD",
      "Create GitOps (ArgoCD) extension with workload identity"
    ],
    "has_embedding": false
  },
  "timestamp": "2025-06-02T15:36:19.458858"
}