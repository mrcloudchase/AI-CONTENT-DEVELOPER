{
  "data": {
    "content": "### Can't install AMA pods on Oracle Linux 9.x\n\nIf you try to install Azure Monitor Agent (AMA) on an Oracle Linux (Red Hat Enterprise Linux (RHEL)) 9.x Kubernetes cluster, the AMA pods and the AMA-RS pod might not work correctly due to the `addon-token-adapter` container in the pod. When you check the logs of the `ama-logs-rs` pod, in `addon-token-adapter container`, you see output that's similar to the following example:\n\n```output\nCommand: kubectl -n kube-system logs ama-logs-rs-xxxxxxxxxx-xxxxx -c addon-token-adapter\n \nError displayed: error modifying iptable rules: error adding rules to custom chain: running [/sbin/iptables -t nat -N aad-metadata --wait]: exit status 3: modprobe: can't change directory to '/lib/modules': No such file or directory\n\niptables v1.8.9 (legacy): can't initialize iptables table `nat': Table does not exist (do you need to insmod?)\n\nPerhaps iptables or your kernel needs to be upgraded.\n```\n\nThis error occurs because installing the extension requires the `iptable_nat` module, but this module isn't automatically loaded in Oracle Linux (RHEL) 9.x distributions.\n\nTo fix this problem, you must explicitly load the `iptables_nat` module on each node in the cluster. Use the `modprobe` command `sudo modprobe iptables_nat`. After you sign into each node and manually add the `iptable_nat` module, retry the AMA installation.\n\n> [!NOTE]\n> Performing this step does not make the `iptables_nat` module persistent.",
    "file_path": "/Users/cloudchase/Desktop/Vibe_Coding/Cursor/ai-content-developer/work/tmp/azure-management-docs/articles/azure-arc/kubernetes/extensions-troubleshooting.md",
    "heading_path": [
      "Troubleshoot extension issues for Azure Arc-enabled Kubernetes clusters",
      "Azure Monitor Container Insights",
      "Can't install AMA pods on Oracle Linux 9.x"
    ],
    "section_level": 3,
    "chunk_index": 10,
    "frontmatter": {
      "title": "Troubleshoot extension issues for Azure Arc-enabled Kubernetes clusters",
      "ms.date": "05/13/2025",
      "ms.topic": "how-to",
      "ms.custom": "devx-track-azurecli, references_regions",
      "description": "Learn how to resolve common problems with Azure Arc-enabled Kubernetes cluster extensions."
    },
    "embedding_content": "Document: Troubleshoot extension issues for Azure Arc-enabled Kubernetes clusters | Topic: how-to | Description: Learn how to resolve common problems with Azure Arc-enabled Kubernetes cluster extensions. | Section: Troubleshoot extension issues for Azure Arc-enabled Kubernetes clusters > Azure Monitor Container Insights > Can't install AMA pods on Oracle Linux 9.x | ### Can't install AMA pods on Oracle Linux 9.x\n\nIf you try to install Azure Monitor Agent (AMA) on an Oracle Linux (Red Hat Enterprise Linux (RHEL)) 9.x Kubernetes cluster, the AMA pods and the AMA-RS pod might not work correctly due to the `addon-token-adapter` container in the pod. When you check the logs of the `ama-logs-rs` pod, in `addon-token-adapter container`, you see output that's similar to the following example:\n\n```output\nCommand: kubectl -n kube-system logs ama-logs-rs-xxxxxxxxxx-xxxxx -c addon-token-adapter\n \nError displayed: error modifying iptable rules: error adding rules to custom chain: running [/sbin/iptables -t nat -N aad-metadata --wait]: exit status 3: modprobe: can't change directory to '/lib/modules': No such file or directory\n\niptables v1.8.9 (legacy): can't initialize iptables table `nat': Table does not exist (do you need to insmod?)\n\nPerhaps iptables or your kernel needs to be upgraded.\n```\n\nThis error occurs because installing the extension requires the `iptable_nat` module, but this module isn't automatically loaded in Oracle Linux (RHEL) 9.x distributions.\n\nTo fix this problem, you must explicitly load the `iptables_nat` module on each node in the cluster. Use the `modprobe` command `sudo modprobe iptables_nat`. After you sign into each node and manually add the `iptable_nat` module, retry the AMA installation.\n\n> [!NOTE]\n> Performing this step does not make the `iptables_nat` module persistent.",
    "embedding": null,
    "embedding_model": null,
    "embedding_generated_at": null,
    "content_hash": "5d204d8c3520434f4403e04a208bc811402036ed6fee605949eec38c534bcba6",
    "file_id": "1f63fa43f2b17b2154d29c1cbb3d1981154d17e29e07c8b9d2d4d14336534624",
    "chunk_id": "18aadcda57c2ff45f15365c4966ecd78d70692fbf9e6f612c62fe6efe3c1d283",
    "prev_chunk_id": "f5488bff8e1616c911cf7f58c33d625b62feef23d7f9fd5a10c9f0ddff3a647a",
    "next_chunk_id": "5c2cbff9d5d17065412eb85e2440879ddb6ef77ac7c1a6a5a8081e0fb5d1f504",
    "parent_heading_chunk_id": "092233e65432c53700399c1b0810d1c3c6bd1cb43a28e48e33aa2ceda8562ed6",
    "total_chunks_in_file": 28
  },
  "meta": {
    "type": "chunk",
    "file": "/Users/cloudchase/Desktop/Vibe_Coding/Cursor/ai-content-developer/work/tmp/azure-management-docs/articles/azure-arc/kubernetes/extensions-troubleshooting.md",
    "section": [
      "Troubleshoot extension issues for Azure Arc-enabled Kubernetes clusters",
      "Azure Monitor Container Insights",
      "Can't install AMA pods on Oracle Linux 9.x"
    ],
    "has_embedding": false
  },
  "timestamp": "2025-06-03T19:17:34.343375"
}