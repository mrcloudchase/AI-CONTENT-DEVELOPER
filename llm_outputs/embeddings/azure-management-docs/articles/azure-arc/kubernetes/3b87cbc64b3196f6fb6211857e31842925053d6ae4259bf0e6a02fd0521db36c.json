{
  "data": {
    "content": "### Errors installing the microsoft.flux extension\n\nThe `microsoft.flux` extension installs Flux controllers and Azure GitOps agents in an Azure Arc-enabled Kubernetes cluster or AKS cluster. If the extension isn't already installed in a cluster and you [create a GitOps configuration resource](tutorial-use-gitops-flux2.md) for the cluster, the extension is installed automatically.\n\nIf you experience an error during installation or if the extension shows a `Failed` state, make sure that the cluster doesn't have any policies that restrict creating the `flux-system` namespace or any of the resources in that namespace.\n\nFor an AKS cluster, ensure that the `Microsoft.ContainerService/AKS-ExtensionManager` feature flag is enabled in the Azure subscription:\n\n```azurecli\naz feature register --namespace Microsoft.ContainerService --name AKS-ExtensionManager\n```\n\nNext, run the following command to determine if there are other problems. Set the cluster type parameter (`-t`) to `connectedClusters` for an Azure Arc-enabled cluster, or to `managedClusters` for an AKS cluster. If the extension was installed automatically when you created your GitOps configuration, the name of the `microsoft.flux` extension is `flux`.\n\n```azurecli\naz k8s-extension show -g <RESOURCE_GROUP> -c <CLUSTER_NAME> -n flux -t <connectedClusters or managedClusters>\n```\n\nThe output can help you identify the problem and how to fix it. Possible remediation actions include:\n\n- Force-delete the extension by running `az k8s-extension delete --force -g <RESOURCE_GROUP> -c <CLUSTER_NAME> -n flux -t <managedClusters OR connectedClusters>`.\n- Uninstall the Helm release by running `helm uninstall flux -n flux-system`.\n- Delete the `flux-system` namespace from the cluster by running `kubectl delete namespaces flux-system`.\n\nThen, you can either [create a new Flux configuration](./tutorial-use-gitops-flux2.md), which installs the `microsoft.flux` extension automatically, or you can [install the Flux extension manually](extensions.md).",
    "file_path": "/Users/cloudchase/Desktop/Vibe_Coding/Cursor/ai-content-developer/work/tmp/azure-management-docs/articles/azure-arc/kubernetes/extensions-troubleshooting.md",
    "heading_path": [
      "Troubleshoot extension issues for Azure Arc-enabled Kubernetes clusters",
      "GitOps (Flux v2)",
      "Errors installing the microsoft.flux extension"
    ],
    "section_level": 3,
    "chunk_index": 4,
    "frontmatter": {
      "title": "Troubleshoot extension issues for Azure Arc-enabled Kubernetes clusters",
      "ms.date": "05/13/2025",
      "ms.topic": "how-to",
      "ms.custom": "devx-track-azurecli, references_regions",
      "description": "Learn how to resolve common problems with Azure Arc-enabled Kubernetes cluster extensions."
    },
    "embedding_content": "Document: Troubleshoot extension issues for Azure Arc-enabled Kubernetes clusters | Topic: how-to | Description: Learn how to resolve common problems with Azure Arc-enabled Kubernetes cluster extensions. | Section: Troubleshoot extension issues for Azure Arc-enabled Kubernetes clusters > GitOps (Flux v2) > Errors installing the microsoft.flux extension | ### Errors installing the microsoft.flux extension\n\nThe `microsoft.flux` extension installs Flux controllers and Azure GitOps agents in an Azure Arc-enabled Kubernetes cluster or AKS cluster. If the extension isn't already installed in a cluster and you [create a GitOps configuration resource](tutorial-use-gitops-flux2.md) for the cluster, the extension is installed automatically.\n\nIf you experience an error during installation or if the extension shows a `Failed` state, make sure that the cluster doesn't have any policies that restrict creating the `flux-system` namespace or any of the resources in that namespace.\n\nFor an AKS cluster, ensure that the `Microsoft.ContainerService/AKS-ExtensionManager` feature flag is enabled in the Azure subscription:\n\n```azurecli\naz feature register --namespace Microsoft.ContainerService --name AKS-ExtensionManager\n```\n\nNext, run the following command to determine if there are other problems. Set the cluster type parameter (`-t`) to `connectedClusters` for an Azure Arc-enabled cluster, or to `managedClusters` for an AKS cluster. If the extension was installed automatically when you created your GitOps configuration, the name of the `microsoft.flux` extension is `flux`.\n\n```azurecli\naz k8s-extension show -g <RESOURCE_GROUP> -c <CLUSTER_NAME> -n flux -t <connectedClusters or managedClusters>\n```\n\nThe output can help you identify the problem and how to fix it. Possible remediation actions include:\n\n- Force-delete the extension by running `az k8s-extension delete --force -g <RESOURCE_GROUP> -c <CLUSTER_NAME> -n flux -t <managedClusters OR connectedClusters>`.\n- Uninstall the Helm release by running `helm uninstall flux -n flux-system`.\n- Delete the `flux-system` namespace from the cluster by running `kubectl delete namespaces flux-system`.\n\nThen, you can either [create a new Flux configuration](./tutorial-use-gitops-flux2.md), which installs the `microsoft.flux` extension automatically, or you can [install the Flux extension manually](extensions.md).",
    "embedding": null,
    "embedding_model": null,
    "embedding_generated_at": null,
    "content_hash": "5dc29f990f86654b2824b9915af81bfe1c7a54d89f04e0bf1a6495c5e8eef9f5",
    "file_id": "1f63fa43f2b17b2154d29c1cbb3d1981154d17e29e07c8b9d2d4d14336534624",
    "chunk_id": "3b87cbc64b3196f6fb6211857e31842925053d6ae4259bf0e6a02fd0521db36c",
    "prev_chunk_id": "4fbc52ea010c4a1f08ee487594a8a17046b3eb243471d5610b8b47730a44f9c6",
    "next_chunk_id": "b0ca6a56e600c6a04a5b36abdcedd057c53a1f63787adae167ff702ac9a05eba",
    "parent_heading_chunk_id": "0c57028fb9b33f4e11df31a1357315db7b9105778a736d1eff0bdd71dfb0c979",
    "total_chunks_in_file": 28
  },
  "meta": {
    "type": "chunk",
    "file": "/Users/cloudchase/Desktop/Vibe_Coding/Cursor/ai-content-developer/work/tmp/azure-management-docs/articles/azure-arc/kubernetes/extensions-troubleshooting.md",
    "section": [
      "Troubleshoot extension issues for Azure Arc-enabled Kubernetes clusters",
      "GitOps (Flux v2)",
      "Errors installing the microsoft.flux extension"
    ],
    "has_embedding": false
  },
  "timestamp": "2025-06-02T15:36:19.871456"
}