{
  "data": {
    "content": "### Cluster created by using Cluster API\n\n1. Copy the guard secret that contains authentication and authorization webhook configuration files from the workload cluster onto your machine:\n\n   ```console\n   kubectl get secret azure-arc-guard-manifests -n kube-system -o yaml > azure-arc-guard-manifests.yaml\n   ```\n\n1. Change the `namespace` field in the *azure-arc-guard-manifests.yaml* file to the namespace within the management cluster where you're applying the custom resources for creation of workload clusters.\n\n1. Apply this manifest:\n\n   ```console\n   kubectl apply -f azure-arc-guard-manifests.yaml\n   ```\n\n1. Edit the `KubeadmControlPlane` object by running `kubectl edit kcp <clustername>-control-plane`:\n\n   1. Add the following specification under `files`:\n\n      ```yml\n      - contentFrom:\n          secret:\n            key: guard-authn-webhook.yaml\n            name: azure-arc-guard-manifests\n        owner: root:root\n        path: /etc/kubernetes/guard-authn-webhook.yaml\n        permissions: \"0644\"\n      - contentFrom:\n          secret:\n            key: guard-authz-webhook.yaml\n            name: azure-arc-guard-manifests\n        owner: root:root\n        path: /etc/kubernetes/guard-authz-webhook.yaml\n        permissions: \"0644\"\n      ```\n\n   1. Add the following specification under `apiServer` > `extraVolumes`:\n\n      ```yml\n      - hostPath: /etc/kubernetes/guard-authn-webhook.yaml\n        mountPath: /etc/guard/guard-authn-webhook.yaml\n        name: guard-authn\n        readOnly: true\n      - hostPath: /etc/kubernetes/guard-authz-webhook.yaml\n        mountPath: /etc/guard/guard-authz-webhook.yaml\n        name: guard-authz\n        readOnly: true\n      ```\n\n   1. Add the following specification under `apiServer` > `extraArgs`:\n\n      ```yml\n      authentication-token-webhook-cache-ttl: 5m0s\n      authentication-token-webhook-config-file: /etc/guard/guard-authn-webhook.yaml\n      authentication-token-webhook-version: v1\n      authorization-mode: Node,RBAC,Webhook\n      authorization-webhook-cache-authorized-ttl: 5m0s\n      authorization-webhook-config-file: /etc/guard/guard-authz-webhook.yaml\n      authorization-webhook-version: v1\n      ```\n\n   1. Save and close to update the `KubeadmControlPlane` object. Wait for these changes to appear on the workload cluster.",
    "file_path": "/Users/cloudchase/Desktop/Vibe_Coding/Cursor/ai-content-developer/work/tmp/azure-management-docs/articles/azure-arc/kubernetes/azure-rbac.md",
    "heading_path": [
      "Use Azure RBAC on Azure Arc-enabled Kubernetes clusters",
      "Enable Azure RBAC on the cluster",
      "Cluster created by using Cluster API"
    ],
    "section_level": 3,
    "chunk_index": 4,
    "frontmatter": {
      "title": "Azure RBAC on Azure Arc-enabled Kubernetes clusters",
      "ms.date": "02/25/2025",
      "ms.topic": "how-to",
      "ms.custom": "devx-track-azurecli",
      "description": "Use Azure RBAC for authorization checks on Azure Arc-enabled Kubernetes clusters."
    },
    "embedding_content": "Document: Azure RBAC on Azure Arc-enabled Kubernetes clusters | Topic: how-to | Description: Use Azure RBAC for authorization checks on Azure Arc-enabled Kubernetes clusters. | Section: Use Azure RBAC on Azure Arc-enabled Kubernetes clusters > Enable Azure RBAC on the cluster > Cluster created by using Cluster API | ### Cluster created by using Cluster API\n\n1. Copy the guard secret that contains authentication and authorization webhook configuration files from the workload cluster onto your machine:\n\n   ```console\n   kubectl get secret azure-arc-guard-manifests -n kube-system -o yaml > azure-arc-guard-manifests.yaml\n   ```\n\n1. Change the `namespace` field in the *azure-arc-guard-manifests.yaml* file to the namespace within the management cluster where you're applying the custom resources for creation of workload clusters.\n\n1. Apply this manifest:\n\n   ```console\n   kubectl apply -f azure-arc-guard-manifests.yaml\n   ```\n\n1. Edit the `KubeadmControlPlane` object by running `kubectl edit kcp <clustername>-control-plane`:\n\n   1. Add the following specification under `files`:\n\n      ```yml\n      - contentFrom:\n          secret:\n            key: guard-authn-webhook.yaml\n            name: azure-arc-guard-manifests\n        owner: root:root\n        path: /etc/kubernetes/guard-authn-webhook.yaml\n        permissions: \"0644\"\n      - contentFrom:\n          secret:\n            key: guard-authz-webhook.yaml\n            name: azure-arc-guard-manifests\n        owner: root:root\n        path: /etc/kubernetes/guard-authz-webhook.yaml\n        permissions: \"0644\"\n      ```\n\n   1. Add the following specification under `apiServer` > `extraVolumes`:\n\n      ```yml\n      - hostPath: /etc/kubernetes/guard-authn-webhook.yaml\n        mountPath: /etc/guard/guard-authn-webhook.yaml\n        name: guard-authn\n        readOnly: true\n      - hostPath: /etc/kubernetes/guard-authz-webhook.yaml\n        mountPath: /etc/guard/guard-authz-webhook.yaml\n        name: guard-authz\n        readOnly: true\n      ```\n\n   1. Add the following specification under `apiServer` > `extraArgs`:\n\n      ```yml\n      authentication-token-webhook-cache-ttl: 5m0s\n      authentication-token-webhook-config-file: /etc/guard/guard-authn-webhook.yaml\n      authentication-token-webhook-version: v1\n      authorization-mode: Node,RBAC,Webhook\n      authorization-webhook-cache-authorized-ttl: 5m0s\n      authorization-webhook-config-file: /etc/guard/guard-authz-webhook.yaml\n      authorization-webhook-version: v1\n      ```\n\n   1. Save and close to update the `KubeadmControlPlane` object. Wait for these changes to appear on the workload cluster.",
    "embedding": null,
    "embedding_model": null,
    "embedding_generated_at": null,
    "content_hash": "f72bd570a33f3eead83077dfd0a55a328d85eb4a37cf419a58697228284524d8",
    "file_id": "3e8ed022d954361887bcaeb5266dfc135ba567b5c7d7df942f9288c9158f0b00",
    "chunk_id": "57698475aa27bb02cc0cd9cdb2d6cc678ae28007b4b524fc8d391641c99978d8",
    "prev_chunk_id": "80851aaac1e09e11793ecd4535f64f5f5853368227a735ca167ba471b368b5bc",
    "next_chunk_id": "85801cfeb977c85523f5fdf1fe2dcef72620d6151d500ed591f230baf38ce2ff",
    "parent_heading_chunk_id": "81b8276aa06d4575b71384fc900abb381da6c007a4db269fdd9a9f8992eca7bf",
    "total_chunks_in_file": 19
  },
  "meta": {
    "type": "chunk",
    "file": "/Users/cloudchase/Desktop/Vibe_Coding/Cursor/ai-content-developer/work/tmp/azure-management-docs/articles/azure-arc/kubernetes/azure-rbac.md",
    "section": [
      "Use Azure RBAC on Azure Arc-enabled Kubernetes clusters",
      "Enable Azure RBAC on the cluster",
      "Cluster created by using Cluster API"
    ],
    "has_embedding": false
  },
  "timestamp": "2025-06-02T15:36:19.204253"
}